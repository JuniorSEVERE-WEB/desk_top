<!DOCTYPE html>
<html>
  <head>
    <title>React Basics - DEBUG VERSION</title>
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">

        function App() {
            const [quote, setQuote] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [error, setError] = React.useState(null);

            // üêõ DEBUG: Observer les changements d'√©tat
            console.log("üîÑ RENDER - loading:", loading, "quote:", quote ? "OUI" : "NON", "error:", error ? "OUI" : "NON");

            const localQuote = [
                {
                    content: "La vie est un myst√®re",
                    author: "Anonyme"
                },
                {
                    content: "La vie est belle",
                    author: "J.K.Rowling"
                },
                {
                    content: "La vie est un combat",
                    author: "A.Einstein"
                }
            ];

            const fetchQuote = async() => {
                console.log("üöÄ fetchQuote DEBUT - setLoading(true)");
                setLoading(true);
                setError(null);

                try {
                    console.log("üì° Envoi requ√™te API...");
                    const response = await fetch('https://api.quotable.io/random');
                    
                    if (!response.ok) {
                        throw new Error("Failed to fetch quote");
                    }
                    
                    const data = await response.json();
                    console.log("‚úÖ API SUCCESS - Citation re√ßue:", data.content.substring(0, 30) + "...");
                    
                    setQuote({
                        content: data.content,
                        author: data.author
                    });
                } catch(error) {
                    console.log("‚ùå API ERROR - Utilisation citation locale");
                    setError(error);
                    const randomIndex = Math.floor(Math.random() * localQuote.length);
                    setQuote(localQuote[randomIndex]);
                } finally {
                    console.log("üèÅ fetchQuote FIN - setLoading(false)");
                    setLoading(false);
                }
            };

            React.useEffect(() => {
                console.log("‚ö° useEffect d√©clench√© - Appel fetchQuote()");
                fetchQuote();
            }, []);

            // üêõ DEBUG: V√©rifier l'affichage conditionnel
            const showLoading = loading;
            const showError = !!error;
            const showQuote = !!quote;
            
            console.log("üñºÔ∏è AFFICHAGE - Loading:", showLoading, "Error:", showError, "Quote:", showQuote);

            return(
                <div style={{ padding: "20px", maxWidth: "600px", margin: "0 auto" }}>
                    <h1>Citation al√©atoire (DEBUG)</h1>
                    
                    <div style={{backgroundColor: '#f0f0f0', padding: '10px', marginBottom: '20px'}}>
                        <h3>üêõ √âtats actuels :</h3>
                        <p>loading: <strong>{loading ? "TRUE ‚úÖ" : "FALSE ‚ùå"}</strong></p>
                        <p>error: <strong>{error ? "TRUE ‚úÖ" : "FALSE ‚ùå"}</strong></p>
                        <p>quote: <strong>{quote ? "TRUE ‚úÖ" : "FALSE ‚ùå"}</strong></p>
                    </div>
                    
                    {loading && (
                        <div style={{backgroundColor: 'yellow', padding: '10px'}}>
                            <p>‚è≥ Chargement... (loading = true)</p>
                        </div>
                    )}
                    
                    {error && <p style={{color: 'red'}}>‚ùå Erreur: {error.message}</p>}
                    
                    {quote && (
                        <blockquote style={{
                            border: '1px solid #ccc', 
                            padding: '20px', 
                            margin: '20px 0',
                            backgroundColor: '#f9f9f9'
                        }}>
                            <p style={{fontSize: '18px', fontStyle: 'italic', marginBottom: '10px'}}>
                                "{quote.content}"
                            </p>
                            <footer style={{textAlign: 'right', fontWeight: 'bold', color: '#666'}}>
                                ‚Äî {quote.author}
                            </footer>
                        </blockquote>
                    )}
                    
                    <button 
                        onClick={fetchQuote} 
                        style={{
                            padding: '10px 20px', 
                            fontSize: '16px',
                            backgroundColor: '#007bff',
                            color: 'white',
                            border: 'none',
                            borderRadius: '5px',
                            cursor: 'pointer'
                        }}
                    >
                        üîÑ Nouvelle citation (voir console F12)
                    </button>
                </div>
            );
        }

        const container = document.querySelector('.js-container');
        ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>
